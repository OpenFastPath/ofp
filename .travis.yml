language: c
dist: xenial
sudo: required

arch:
    - amd64
    - arm64

addons:
    apt:
        packages:
            - codespell
            - libconfig-dev

install:
    - curl -sSL https://github.com/Linaro/libcunit/releases/download/2.1-3/CUnit-2.1-3.tar.bz2 | tar jx
    - cd CUnit-2.1-3
    - ./bootstrap
    - ./configure --prefix=$(pwd)/install
    - make install
    - export CPPFLAGS="-I$(pwd)/install/include $CPPFLAGS"
    - export LDFLAGS="-L$(pwd)/install/lib $LDFLAGS"
    - cd ..

script: ./scripts/travis.sh

jobs:
    include:
        - stage: test
          canfail: yes
          env: TEST=checkpatch
          compiler: gcc
          install:
                - true
          script:
                - echo ${TRAVIS_COMMIT_RANGE};
                - OFP_PATCHES=`echo ${TRAVIS_COMMIT_RANGE} | sed 's/\.//'`;
                - ./scripts/ci-checkpatches.sh ${OFP_PATCHES};
    allow_failures:
      - canfail: yes
